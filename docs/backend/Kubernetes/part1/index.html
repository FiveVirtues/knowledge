<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes-01-环境搭建 | 知识库</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="">
    <meta property="og:url" content="/backend/Kubernetes/part1.html">
    <meta property="og:site_name" content="知识库">
    <meta property="og:title" content="Kubernetes-01-环境搭建">
    <meta property="og:description" content="K8s 介绍 前置知识 Linux; Docker; K8s 介绍 Kunernetes，简称 K8s，因为 K 和 s 之间有 8 个字符，所以简称 8。这是一个开源的，用于管理云平台中多个主机上的容器化的应用。 K8s 是 Google 开发的，在经过生产环境十几年的考验之后，不断完善，最终在 2014 年开源出来。 传统的应用部署方式方式通过插件或者脚">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="知识库">
    <meta property="article:author" content="causes">
    <meta property="article:tag" content="k8s">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.272a7e09.css" as="style"><link rel="preload" href="/assets/js/app.00946664.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.d74da02a.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.70129eef.js" as="script"><link rel="preload" href="/assets/js/page-Kubernetes-01-环境搭建.ee022329.js" as="script"><link rel="prefetch" href="/assets/js/54.7c746378.js"><link rel="prefetch" href="/assets/js/55.adda53bb.js"><link rel="prefetch" href="/assets/js/56.0f8d034a.js"><link rel="prefetch" href="/assets/js/57.830d518c.js"><link rel="prefetch" href="/assets/js/58.fcb3cf84.js"><link rel="prefetch" href="/assets/js/59.2826e1cb.js"><link rel="prefetch" href="/assets/js/layout-Blog.65a26112.js"><link rel="prefetch" href="/assets/js/layout-Layout.ae1bffbb.js"><link rel="prefetch" href="/assets/js/layout-NotFound.afd3c492.js"><link rel="prefetch" href="/assets/js/layout-Slide.5d36817b.js"><link rel="prefetch" href="/assets/js/page--6ce8a11a.1f6d1c8c.js"><link rel="prefetch" href="/assets/js/page-Concurrent-01-基础.40d9681c.js"><link rel="prefetch" href="/assets/js/page-Docker-01-基础.83220b10.js"><link rel="prefetch" href="/assets/js/page-Docker-02-进阶.52df0704.js"><link rel="prefetch" href="/assets/js/page-Flink-01-基础.068f6e0e.js"><link rel="prefetch" href="/assets/js/page-Flink-02-进阶.a6789756.js"><link rel="prefetch" href="/assets/js/page-Flink-03-机制.c3604e6d.js"><link rel="prefetch" href="/assets/js/page-Flume.578f4bbc.js"><link rel="prefetch" href="/assets/js/page-Git-01-常用指令.93e85005.js"><link rel="prefetch" href="/assets/js/page-HBase-01-起步.7316acb2.js"><link rel="prefetch" href="/assets/js/page-HBase-02-进阶.11b27c25.js"><link rel="prefetch" href="/assets/js/page-Hadoop-01-起步.f49b25f0.js"><link rel="prefetch" href="/assets/js/page-Hadoop-02-HDFS.c28c360c.js"><link rel="prefetch" href="/assets/js/page-Hadoop-03-MapReduce.01e7c831.js"><link rel="prefetch" href="/assets/js/page-Hadoop-04-Yarn.ffaa99bb.js"><link rel="prefetch" href="/assets/js/page-Hive-01-起步.c51a8ed6.js"><link rel="prefetch" href="/assets/js/page-Hive-02-DDL.62ca23de.js"><link rel="prefetch" href="/assets/js/page-Hive-03-DML.d3eb8c90.js"><link rel="prefetch" href="/assets/js/page-Hive-04-DQL.c2e0815a.js"><link rel="prefetch" href="/assets/js/page-Hive-05-函数.585851e7.js"><link rel="prefetch" href="/assets/js/page-JVM-01-概述.ebc66336.js"><link rel="prefetch" href="/assets/js/page-JVM-02-类加载子系统.4442a927.js"><link rel="prefetch" href="/assets/js/page-JVM-03-运行时数据区.947c0cac.js"><link rel="prefetch" href="/assets/js/page-Kafka-01-起步.246fa824.js"><link rel="prefetch" href="/assets/js/page-Kafka-02-架构和API.95741e08.js"><link rel="prefetch" href="/assets/js/page-Kafka-03-组件对接.adf6b6fb.js"><link rel="prefetch" href="/assets/js/page-Kubernetes-02-操作.0263d70c.js"><link rel="prefetch" href="/assets/js/page-Linux-01-基础篇.7a082019.js"><link rel="prefetch" href="/assets/js/page-Linux-02-实际操作篇.a1a0de05.js"><link rel="prefetch" href="/assets/js/page-Linux-03-安装配置.4afb662a.js"><link rel="prefetch" href="/assets/js/page-Linux-04-Shell.4bea5dda.js"><link rel="prefetch" href="/assets/js/page-Proxy.4595451b.js"><link rel="prefetch" href="/assets/js/page-Spark-01-SparkCore.e1b13d59.js"><link rel="prefetch" href="/assets/js/page-Spark-02-SparkSQL.0e447d14.js"><link rel="prefetch" href="/assets/js/page-Zookeeper.d3a8c3a8.js"><link rel="prefetch" href="/assets/js/page-数据结构与算法-01-概述.da9332d8.js"><link rel="prefetch" href="/assets/js/page-注意事项.97c989bf.js"><link rel="prefetch" href="/assets/js/page-设计模式-01-介绍.2a0d66a1.js"><link rel="prefetch" href="/assets/js/page-设计模式-02-创建者模式.4c12c25f.js"><link rel="prefetch" href="/assets/js/page-设计模式-03-结构型模式.af84c495.js"><link rel="prefetch" href="/assets/js/page-设计模式-04-行为型模式.2a0f6172.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.f091f770.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.9c96c271.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.e4b622ba.js"><link rel="prefetch" href="/assets/js/vendors~reveal.80ac799a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.272a7e09.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">知识库</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont icon-reco-faq"></i>
  关于
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://gitlab.com/team401/knowledge" target="_blank" class="repo-link can-hide">
  GitLab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info"><div data-balloon-pos="" role="navigation" class="blogger"><!----> <div property="name" class="name">知识库</div> <!----></div> <div class="num-wrapper"><div><div class="num">41</div> <div>Articles</div></div> <div><div class="num">3</div> <div>Category</div></div> <div><div class="num">17</div> <div>Tags</div></div> <div><div class="num">41</div> <div>Timeline</div></div></div> <!----></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont icon-reco-faq"></i>
  关于
</a></div> <a rel="noopener noreferrer" href="https://gitlab.com/team401/knowledge" target="_blank" class="repo-link">
  GitLab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Kubernetes-01-环境搭建</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">causes</span></span><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-7-17</span></span><!----><span aria-label="Tags🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">K8s</span></li></ul> <meta property="keywords" content="K8s"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 10 min</span> <meta property="timeRequired" content="PT10M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/backend/Kubernetes/part1/#k8s-介绍" class="anchor-link heading2"><div>K8s 介绍</div></a></li><li class="anchor"><a href="/backend/Kubernetes/part1/#搭建-k8s-集群" class="anchor-link heading2"><div>搭建 K8s 集群</div></a></li><li class="anchor"><a href="/backend/Kubernetes/part1/#先行介绍" class="anchor-link heading3"><div>先行介绍</div></a></li><li class="anchor"><a href="/backend/Kubernetes/part1/#主机环境初始化" class="anchor-link heading3"><div>主机环境初始化</div></a></li><li class="anchor"><a href="/backend/Kubernetes/part1/#搭建-minikube" class="anchor-link heading2"><div>搭建 minikube</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="k8s-介绍"><a href="#k8s-介绍" class="header-anchor">#</a> K8s 介绍</h2> <p><strong>前置知识</strong></p> <ul><li><code>Linux</code></li> <li><code>Docker</code></li></ul> <p><strong>K8s 介绍</strong></p> <p><code>Kunernetes</code>，简称 K8s，因为 K 和 s 之间有 8 个字符，所以简称 8。这是一个开源的，用于管理云平台中多个主机上的容器化的应用。</p> <p>K8s 是 Google 开发的，在经过生产环境十几年的考验之后，不断完善，最终在 2014 年开源出来。</p> <p>传统的应用部署方式方式通过插件或者脚本来安装应用，这样做的缺点是应用的运行、配置、管理、所有生存周期将与当前操作系统绑定，这样做并不利于应用的升级更新/回滚等操作，虽然可以通过虚拟机的方式来实现某些功能，但是虚拟机非常重，并不利于可移植性。</p> <p>新的方式是通过部署容器方式实现，简单来讲就是带环境安装，让生产环境和测试环境保持一致，避免很多不必要的麻烦。</p> <p>容器化部署，Docker 虽然也可以做，但是上限也就在大几百，一旦数量增多，Docker 也就有心无力了。K8s 支持自动化部署、大规模的升级/回滚操作，让部署的过程更加简洁方便。</p> <p><strong>K8s 功能</strong>0</p> <ul><li>自动装箱：自动完成，无需手动。</li> <li>自我修复：当主节点挂掉之后，副节点会自动启动，启动并且自检之后对外提供服务。</li> <li>水平扩展：高峰期可以自动扩展副本，高峰期过后会自动缩减副本。</li> <li>服务发现：负载均衡。</li> <li>滚动更新：应用加某几个服务之后，首先进行自检，检查之后没有问题对外提供服务。</li> <li>版本回退：新的版本有 BUG，可以回退到上个版本。</li> <li>密钥和配置管理：热部署，不需要重新构建镜像就可以更新配置。</li> <li>存储编排：存储系统可以来自本地或者外部、云存储等。</li> <li>批处理：支持一次任务、定时任务。</li></ul> <p><strong>K8s 集群架构组件</strong></p> <p>Kubernetes 的本质其实是一组服务器集群，它可以在集群的每个节点上运行特定的程序，来对节点中的容器进行管理，目的是为了实现资源管理的自动化。</p> <p>一个 Kubernetes 集群中的节点主要分为两大类：控制节点（master），工作节点（node），每一个节点上都会安装不同的组件。</p> <p><img src="/assets/img/2021-08-19-20-05-24.8c821cf2.png" alt="2021-08-19-20-05-24"></p> <ul><li><p>Master Node：主控节点（管理节点）。</p> <ul><li>API Server：集群控制的统一入口，各个组件的协调者。提供认证、授权、API 注册、发现等机制。</li> <li>Scheduler：节点调度，选择工作节点应用部署。</li> <li>Controller Manager：负责维护集群的状态，比如程序部署安排，自动扩展，滚动更新等。</li> <li>ETCD：存储系统，用于保存集群中的相关数据。</li></ul> <p>使用这样的方式干巴巴的，所以来举个例子作为说明。比如我想要在 Kubernetes 集群上运行一个服务 Nginx，那么：</p> <ol><li>首先跑到 API Server 这个入口中进入 Kubernetes 集群。</li> <li>Scheduler 去计算，去判断这个活应该交给哪个工作节点来做，比如最后算出来应该交给 Node1，然后交给 API Server 这个信息。</li> <li>Controller Manager 从 API Server 中得知，工作应该交给  Node1 来做，那么 Controller Manager 就去派活。</li> <li>派活之后管理者应该有一个单子，里面列着谁干了什么活，那么这个就交给 ETCD 存储。</li></ol></li> <li><p>Worker Node：工作节点（做事情的节点）。</p> <ul><li>Kubelet：Master Node 派到 Worker Node 的一个代表，管理当前节点的容器部分。</li> <li>Kube-proxy：提供网络代理，利用它也可以实现负载均衡等操作。</li> <li>Docker：节点上容器的各种操作。</li></ul> <p>node 节点当然就是最后用来干活的节点，但是里面的组件也比较复杂，我们还是以刚才的例子来讲：</p> <ol><li>刚才说到，Controller Manager 将活派给了 Node1 节点，那么这个 Node1 节点应该有一个耳朵可以听，有能力可以进行任务分配，那么组件 Kubelet 就是干这个用的，Controller Manager 和 Kubelet 对接。</li> <li>Kubelet 也不干活，Kubelet 会将工作分配给 Docker 来干活，Docker 内部会启动一个有一个的 Pod，交给这些 Pod 去执行任务，Nginx 就运行在这些 Pod 上。</li> <li>Nginx 运行中，我们想要访问，就要通过 kube-proxy 来进行访问 Nginx。</li></ol></li></ul> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <ol><li>以后如果单单提到 Master 指的就是 Master Node，如果单单提到 Node 指的就是 Worker Node。</li> <li>master 中，Scheduler 只负责计算任务应该交给谁，分配任务是 Controller Manager 来负责的。</li> <li>ETCD 只是 Kubernetes 集群自带的一个存储工具，完全可以自己配置为别的东西，比如 MySQL。</li></ol></div> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <ol><li><p>Kubelet 就相当于工地的工头，它本身不干活，是一个小任务的管理者。</p></li> <li><p>访问某一个具体的程序是通过 kube-proxy 来访问的，但是注意不要把它和 API Server 混淆了。</p> <p>API Server 是整个集群的控制节点，我们访问集群中的内容才通过 API Server 去访问。</p> <p>而 Kubelet 只是工作节点上运行的一个程序而已，本身我们没有访问集群中的组件，也没有进行集群控制，所以不需要使用 API Server。</p></li></ol></div> <p>我们再以 Nginx 部署来说明 Kubernetes 各个组件的关系：</p> <ol><li>首先明确，一旦 Kubernetes 集群启动之后，master 和 node 的信息都会存储到 etcd 数据库中。</li> <li>一个 Nginx 服务的安装请求首先会发送到 ApiServer上。</li> <li>Scheduler 会来决定是将服务安装到什么 node 节点上，然后将结果告知给 API Server。</li> <li>API Server 调用 Controller Manager，来安排工作给 node。</li> <li>Kubelet 在 node 节点上等着接活，这个时候 Controller Manager 将工作内容交给了 Kubelet。</li> <li>Kubelet 接受到了指令，会通知给 Docker，然后 Docker 会启动一个 Nginx 的 Pod。</li> <li>Nginx 服务运行在了 Pod 上，假如想要访问这个服务，那么必须要通过 kube-proxy 来对 Pod 产生访问的代理。</li></ol> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <p>Pod 是 Kubernetes 的最小操作单元，容器必须跑在 Pod 中。</p></div> <p><strong>K8s 核心概念</strong></p> <ul><li><p>Master：集群控制节点，每一个集群至少需要一个 master 节点负责管理集群。</p></li> <li><p>Node：工作负载节点，干活的节点。</p></li> <li><p>Pod：Kubernetes 中的最小控制单元。</p></li> <li><p>Controller：简单来讲就是用 Controller 对 Pod 管理，比如启动 Pod，关闭 Pod，伸缩 Pod 数量等。</p> <p>Pod 是最小的控制单元，但是我们一般不会直接操控 Pod，而是通过 Pod 控制器（Controller）来实现对 Pod 的控制。
控制器在 Kubernetes 中不是一个概念，而是一类概念，控制器有很多种，每一种控制器都有它适合的场景。</p></li> <li><p>Service：Pod 对外服务的统一入口，下面可以维护同一类的多个 Pod。</p></li> <li><p>Label：用于对 Pod 分类，同一类的 Pod 拥有多个相同的 Label。</p></li> <li><p>NameSpace：隔离 Pod 的运行环境。</p> <p>在默认情况下，一个 Kubernetes 中的所有 pod 是可以相互访问的，但是我们可以通过配置 namespace 来隔绝 pod 之间的相互访问，或者做到某几个 pod 可以相互访问，其他的不行，等等。</p></li></ul> <p><img src="/assets/img/2021-08-19-20-44-08.e909f425.png" alt="2021-08-19-20-44-08"></p> <p>在上图中，四个紫色的 tomcat 是在 pod 上启动的，service 作为 pod 提供服务的统一入口，用这个来实现负载均衡的效果。</p> <p>在上图中可以看到，有两类标签：<code>app: tom</code>、<code>app: tomcat</code>，service 通过标签来将 pod 分类，维护了标签相同的 pod。</p> <h2 id="搭建-k8s-集群"><a href="#搭建-k8s-集群" class="header-anchor">#</a> 搭建 K8s 集群</h2> <h3 id="先行介绍"><a href="#先行介绍" class="header-anchor">#</a> 先行介绍</h3> <p><strong>平台规划</strong></p> <p>之前的内容中提到过，K8s 的两个节点：Master 和 Node，Node 肯定是多个的，那么就要看 Master。</p> <p>所以我们有两个规划：<em>单 Master 集群</em>和<em>多 Master 集群</em>。</p> <p><img src="data:image/png;base64,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" alt="2021-08-04-20-12-25"></p> <p><img src="data:image/png;base64,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" alt="2021-08-04-20-14-05"></p> <p>为了测试简单，我们使用一主两从的集群来作为测试环境的搭建。</p> <p><strong>安装方式</strong></p> <p>kubernetes 有多种部署方式，目前的主流方式有 minikube、kubeadm、二进制包：</p> <ul><li>minikube：搭建单节点的 kubernetes 工具，这个我们不做考虑（我们要搭建的是集群）。</li> <li>kubeadm：快速搭建 kubernetes 的工具。</li> <li>二进制包：从官网上下载每一个组件的二进制包，依次安装，这个对于理解 kubernetes 的组件更加有效。</li></ul> <p>我们现在使用的是 kubeadm 的方式来进行安装。</p> <p><strong>主机规划</strong></p> <table><thead><tr><th>作用</th> <th>IP 地址</th> <th>配置</th></tr></thead> <tbody><tr><td>Master</td> <td>192.168.109.100</td> <td>2 CPU，2 G 内存，50 G 硬盘</td></tr> <tr><td>Node1</td> <td>192.168.109.101</td> <td>2 CPU，2 G 内存，50 G 硬盘</td></tr> <tr><td>Node2</td> <td>192.168.109.102</td> <td>2 CPU，2 G 内存，50 G 硬盘</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <p>主机规划时注意，选择软件安装时，选择基础设施服务器。</p></div> <h3 id="主机环境初始化"><a href="#主机环境初始化" class="header-anchor">#</a> 主机环境初始化</h3> <h4 id="主机安装"><a href="#主机安装" class="header-anchor">#</a> 主机安装</h4> <ol><li><p>检查操作系统版本，CentOS 必须要在 7.5 上。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/redhat-release
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>设置主机名的解析，编辑 <code>/etc/hosts</code> 文件，这是测试服务器，企业环境中一般使用 DNS 服务器做解析：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">192.168</span>.109.100 master
<span class="token number">192.168</span>.109.101 node1
<span class="token number">192.168</span>.109.102 node2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>时间同步，Kubernetes 要求集群中的节点时间必须精确一致，这里直接使用 chronyd 服务从网络同步时间：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl start chronyd
systemctl <span class="token builtin class-name">enable</span> chronyd
<span class="token comment"># 等待几秒，使用 date 来验证时间</span>
<span class="token function">date</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Kubernetes 和 Docker 在启动的时候会产生大量的 iptables 规则，为了不让系统规则和他们混淆，我们关闭系统规则，生产环境防火墙关闭一定要慎重：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl stop firewalld
systemctl disable firewalld
systemctl stop iptables
systemctl disable iptables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>禁用 selinux，selinux 是一个 Linux 下的安全服务，假如不关闭，可能会产生一些奇葩问题，编辑 <code>/etc/selinux/config</code>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>禁用 swap 分区：</p> <p>swap 分区在 Linux 指的是虚拟内存分区，在物理内存满了之后，用磁盘空间当内存用。</p> <p>但是 swap 分区会对系统设备产生极其负面的影响，所以 Kubernetes 要求每一个节点都要禁用 swap 设备，假如实在关不掉，在启动集群的时候就要明确指定参数配置。</p> <p>编辑 <code>/etc/fstab</code>，编辑完成之后重启 Linux：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># /dev/mapper/centos-swap swap                    swap    defaults        0 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改 Linux 内核参数：</p> <p>为 Linux 添加网桥过滤和地址转发功能，修改 <code>/etc/sysctl.d/kubernetes.conf</code>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>重新加载配置：<code>sysctl -p</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 网桥过滤</span>
modprobe br_netfilter
<span class="token comment"># 查看是否加载成功</span>
lsmod <span class="token operator">|</span> <span class="token function">grep</span> br_netfilter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>配置 ipvs 功能</p> <p>kubernetes 中和 service 中有两种代理模式：iptables 和 ipvs，ipvs 的性能高，需要手动载入。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum -y <span class="token function">install</span> ipset ipvsadmin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/sysconfig/modules/ipvs.modules</span>
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 增加可执行权限，之后执行</span>
<span class="token function">chmod</span> +x /etc/sysconfig/modules/ipvs.modules
<span class="token comment"># 查看是否加载成功</span>
lsmod <span class="token operator">|</span> <span class="token function">grep</span> -e ip_vs -e nf_conntrack_ipv4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>重启 Linux</p></li></ol> <h2 id="搭建-minikube"><a href="#搭建-minikube" class="header-anchor">#</a> 搭建 minikube</h2> <p><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer">minikube<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，是单节点的 k8s 集群，主要用于本机测试、学习使用。适合配置不高的电脑。</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://gitlab.com/team401/knowledge/-/edit/main/backend/Kubernetes/part1.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">July 11, 2022 16:17</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 2592716753@qq.com" class="contributor">
          红枫
        </span> , <span title="email: 2592716753@qq.com" class="contributor">
          causes
        </span> , <span title="email: maple.wang@maiscrm.com" class="contributor">
          Maple Wang
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href="https://beian.miit.gov.cn/#/Integrated/index">鲁ICP备20021989号-2</a></div> <!----></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.00946664.js" defer></script><script src="/assets/js/vendors~layout-Layout.d74da02a.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.70129eef.js" defer></script><script src="/assets/js/page-Kubernetes-01-环境搭建.ee022329.js" defer></script>
  </body>
</html>
