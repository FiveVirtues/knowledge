<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM-02-类加载子系统 | 知识库</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="">
    <meta property="og:url" content="/backend/JVM/part2.html">
    <meta property="og:site_name" content="知识库">
    <meta property="og:title" content="JVM-02-类加载子系统">
    <meta property="og:description" content="类加载器和类的加载过程 类加载子系统的作用主要有： 1. 类加载子系统（类加载器）负责从文件系统/网络中加载 Class 文件： ClassLoader 只负责 Class 文件的加载，至于是否可以运行，则由 Execution Engine（执行引擎）决定。 1. 加载的类信息存放于一块称为方法区的内存空间。除了类的信息之外，方法区还会存放运行时常量池信息">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="知识库">
    <meta property="article:author" content="causes">
    <meta property="article:tag" content="jvm">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.272a7e09.css" as="style"><link rel="preload" href="/assets/js/app.00946664.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.d74da02a.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.70129eef.js" as="script"><link rel="preload" href="/assets/js/page-JVM-02-类加载子系统.4442a927.js" as="script"><link rel="prefetch" href="/assets/js/54.7c746378.js"><link rel="prefetch" href="/assets/js/55.adda53bb.js"><link rel="prefetch" href="/assets/js/56.0f8d034a.js"><link rel="prefetch" href="/assets/js/57.830d518c.js"><link rel="prefetch" href="/assets/js/58.fcb3cf84.js"><link rel="prefetch" href="/assets/js/59.2826e1cb.js"><link rel="prefetch" href="/assets/js/layout-Blog.65a26112.js"><link rel="prefetch" href="/assets/js/layout-Layout.ae1bffbb.js"><link rel="prefetch" href="/assets/js/layout-NotFound.afd3c492.js"><link rel="prefetch" href="/assets/js/layout-Slide.5d36817b.js"><link rel="prefetch" href="/assets/js/page--6ce8a11a.1f6d1c8c.js"><link rel="prefetch" href="/assets/js/page-Concurrent-01-基础.40d9681c.js"><link rel="prefetch" href="/assets/js/page-Docker-01-基础.83220b10.js"><link rel="prefetch" href="/assets/js/page-Docker-02-进阶.52df0704.js"><link rel="prefetch" href="/assets/js/page-Flink-01-基础.068f6e0e.js"><link rel="prefetch" href="/assets/js/page-Flink-02-进阶.a6789756.js"><link rel="prefetch" href="/assets/js/page-Flink-03-机制.c3604e6d.js"><link rel="prefetch" href="/assets/js/page-Flume.578f4bbc.js"><link rel="prefetch" href="/assets/js/page-Git-01-常用指令.93e85005.js"><link rel="prefetch" href="/assets/js/page-HBase-01-起步.7316acb2.js"><link rel="prefetch" href="/assets/js/page-HBase-02-进阶.11b27c25.js"><link rel="prefetch" href="/assets/js/page-Hadoop-01-起步.f49b25f0.js"><link rel="prefetch" href="/assets/js/page-Hadoop-02-HDFS.c28c360c.js"><link rel="prefetch" href="/assets/js/page-Hadoop-03-MapReduce.01e7c831.js"><link rel="prefetch" href="/assets/js/page-Hadoop-04-Yarn.ffaa99bb.js"><link rel="prefetch" href="/assets/js/page-Hive-01-起步.c51a8ed6.js"><link rel="prefetch" href="/assets/js/page-Hive-02-DDL.62ca23de.js"><link rel="prefetch" href="/assets/js/page-Hive-03-DML.d3eb8c90.js"><link rel="prefetch" href="/assets/js/page-Hive-04-DQL.c2e0815a.js"><link rel="prefetch" href="/assets/js/page-Hive-05-函数.585851e7.js"><link rel="prefetch" href="/assets/js/page-JVM-01-概述.ebc66336.js"><link rel="prefetch" href="/assets/js/page-JVM-03-运行时数据区.947c0cac.js"><link rel="prefetch" href="/assets/js/page-Kafka-01-起步.246fa824.js"><link rel="prefetch" href="/assets/js/page-Kafka-02-架构和API.95741e08.js"><link rel="prefetch" href="/assets/js/page-Kafka-03-组件对接.adf6b6fb.js"><link rel="prefetch" href="/assets/js/page-Kubernetes-01-环境搭建.ee022329.js"><link rel="prefetch" href="/assets/js/page-Kubernetes-02-操作.0263d70c.js"><link rel="prefetch" href="/assets/js/page-Linux-01-基础篇.7a082019.js"><link rel="prefetch" href="/assets/js/page-Linux-02-实际操作篇.a1a0de05.js"><link rel="prefetch" href="/assets/js/page-Linux-03-安装配置.4afb662a.js"><link rel="prefetch" href="/assets/js/page-Linux-04-Shell.4bea5dda.js"><link rel="prefetch" href="/assets/js/page-Proxy.4595451b.js"><link rel="prefetch" href="/assets/js/page-Spark-01-SparkCore.e1b13d59.js"><link rel="prefetch" href="/assets/js/page-Spark-02-SparkSQL.0e447d14.js"><link rel="prefetch" href="/assets/js/page-Zookeeper.d3a8c3a8.js"><link rel="prefetch" href="/assets/js/page-数据结构与算法-01-概述.da9332d8.js"><link rel="prefetch" href="/assets/js/page-注意事项.97c989bf.js"><link rel="prefetch" href="/assets/js/page-设计模式-01-介绍.2a0d66a1.js"><link rel="prefetch" href="/assets/js/page-设计模式-02-创建者模式.4c12c25f.js"><link rel="prefetch" href="/assets/js/page-设计模式-03-结构型模式.af84c495.js"><link rel="prefetch" href="/assets/js/page-设计模式-04-行为型模式.2a0f6172.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.f091f770.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.9c96c271.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.e4b622ba.js"><link rel="prefetch" href="/assets/js/vendors~reveal.80ac799a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.272a7e09.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">知识库</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont icon-reco-faq"></i>
  关于
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://gitlab.com/team401/knowledge" target="_blank" class="repo-link can-hide">
  GitLab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info"><div data-balloon-pos="" role="navigation" class="blogger"><!----> <div property="name" class="name">知识库</div> <!----></div> <div class="num-wrapper"><div><div class="num">41</div> <div>Articles</div></div> <div><div class="num">3</div> <div>Category</div></div> <div><div class="num">17</div> <div>Tags</div></div> <div><div class="num">41</div> <div>Timeline</div></div></div> <!----></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont icon-reco-faq"></i>
  关于
</a></div> <a rel="noopener noreferrer" href="https://gitlab.com/team401/knowledge" target="_blank" class="repo-link">
  GitLab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">JVM-02-类加载子系统</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">causes</span></span><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-9-20</span></span><!----><span aria-label="Tags🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Jvm</span></li></ul> <meta property="keywords" content="Jvm"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 11 min</span> <meta property="timeRequired" content="PT11M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/backend/JVM/part2/#类加载器和类的加载过程" class="anchor-link heading2"><div>类加载器和类的加载过程</div></a></li><li class="anchor"><a href="/backend/JVM/part2/#类加载器的三个阶段" class="anchor-link heading2"><div>类加载器的三个阶段</div></a></li><li class="anchor"><a href="/backend/JVM/part2/#类加载器" class="anchor-link heading2"><div>类加载器</div></a></li><li class="anchor"><a href="/backend/JVM/part2/#双亲委派机制和沙箱安全机制" class="anchor-link heading2"><div>双亲委派机制和沙箱安全机制</div></a></li><li class="anchor"><a href="/backend/JVM/part2/#类的主动使用和被动使用" class="anchor-link heading2"><div>类的主动使用和被动使用</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="类加载器和类的加载过程"><a href="#类加载器和类的加载过程" class="header-anchor">#</a> 类加载器和类的加载过程</h2> <p>类加载子系统的作用主要有：</p> <ol><li><p>类加载子系统（类加载器）负责从文件系统/网络中加载 Class 文件：</p> <p>ClassLoader 只负责 Class 文件的加载，至于是否可以运行，则由 Execution Engine（执行引擎）决定。</p></li> <li><p>加载的类信息存放于一块称为方法区的内存空间。除了类的信息之外，方法区还会存放运行时常量池信息，可能还包含字符串字面量和数字常量。</p></li></ol> <h2 id="类加载器的三个阶段"><a href="#类加载器的三个阶段" class="header-anchor">#</a> 类加载器的三个阶段</h2> <p><img src="/assets/img/0ec43b4d-b5e9-46b9-b476-16a838111aca.9927644e.png" alt="类加载器全貌"></p> <p>字节码的加载和类加载子系统的加载阶段并不一样，它的加载分为三个部分：加载、链接、初始化。</p> <p><strong>加载阶段 Loading</strong></p> <p>它有如下步骤：</p> <ol><li><p>通过一个类的全限定类名获取这个类的二进制字节流。</p> <p>有如下方式加载 <code>.class</code> 文件：</p> <ul><li>从本地系统中直接加载。</li> <li>从网络中获取，典型场景是 Web Applet（直接嵌入到 HTML 页面中，由支持 Java 的浏览器解释执行，现在几乎绝迹）。</li> <li>从 zip 压缩包中获取。</li> <li>运行时计算生成，典型场景是 JSP 应用。</li> <li>从加密文件中获取，典型场景是防止 Class 文件被反编译的保护措施。</li></ul></li> <li><p>将这个字节流所代表的静态存储结构转换为方法区的运行时数据结构。</p> <p>方法区首先只有 Hotspot 虚拟机才有这个概念，并且方法区是一个抽象的概念，而不是具体的实现。在不同的 JDK 版本中有不同的实现。
比如在 JDK7 及以前，方法区的落地实现为永久代；JDK8 及以后，方法区的落地实现为元空间。
为了方便称呼，我们不讲方法区的区别时统称方法区。</p></li> <li><p>在内存中生成一个代表这个类的 <code>java.lang.Class</code> 对象，作为方法区这个类的各种数据的访问入口。</p> <p>通过反射就可以使用这个 Class。</p></li></ol> <p><strong>链接阶段 Linking</strong></p> <p>链接分为三部分：</p> <ol><li><p>Verify 验证：</p> <p>主要目的是为了确保 Class 文件是格式正确的，符合虚拟机要求的（比如 Class 文件一律使用 <code>CA FE BA BE</code> 开头），不会损害虚拟机自身安全的。
这个步骤和之后执行引擎是否可以运行是两码事，首先在这里确保 Class 文件格式正确，之后再交给执行引擎查看是否能够运行。</p> <p>验证阶段主要包含四种验证：文件格式验证、元数据验证、字节码验证、符号引用验证。</p> <p>如果需要查看字节码文件：</p> <ul><li><a href="https://github.com/ingokegel/jclasslib" target="_blank" rel="noopener noreferrer">JClassLib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看（主要用于类似反编译之后的文件），IDEA 有插件，安装完成之后可以在 <code>View -&gt; Show Bytecode With Jclasslib</code> 中查看，或者直接下载安装包。</li> <li>PXBinaryView：查看 Class 文件的二进制编码。</li></ul></li> <li><p>Prepare 准备：</p> <p>为类变量（类中使用 static 修饰的变量）分配内存，并且设置该类变量的默认初始值（即零值）。
这个零值的意思不是 0，是默认值的意思。</p> <p>这里不会为 final 修饰的类变量进行初始化，因为 final 早已经在编译时分配了。
这里不会为实例变量进行初始化，实例变量会随对象一起分配到 Java 堆中。</p></li> <li><p>Resolve 解析：</p></li></ol> <ul><li><p>将常量池中的符号引用转化为直接引用的过程。</p> <p>符号引用就是一组符号，来描述所引用的目标。
直接引用就是直接执行目标的指针、相对偏移量，或者是一个间接定位到目标的句柄。</p></li> <li><p>解析操作往往伴随着 JVM 在进行初始化之后再执行。</p></li> <li><p>解析动作主要针对类或者接口、方法、接口方法、字段、方法类型等。对应常量池中的 <code>CONSTANT_Class_info、CONSTANT_Fieldref_info、CONSTANT_Methodref_info</code> 等。</p></li></ul> <p><strong>初始化阶段 Initialization</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token punctuation">{</span>
   i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/2021-09-25-10-02-19.d0dee6f6.png" alt=""></p> <p><code>&lt;clinit&gt;()</code> 是 class 类构造器，用于对 静态变量和静态代码块进行初始化。</p> <p>这个方法不需要我们去定义，它是 javac 编译器自动收集类中的所有变量的赋值动作和静态代码块中的语句合并而来。</p> <ul><li>构造器方法中指令按语句在源文件中出现的顺序执行（所以静态变量的赋值和静态代码块的赋值谁在前面谁先执行）。</li> <li>假如该类具有父类，那么JVM会保证子类的 <code>&lt;clinit&gt;()</code> 执行之前，父类的 <code>&lt;clint&gt;()</code> 已经执行完毕。</li> <li>虚拟机必须保证一个类的 <code>&lt;clinit&gt;()</code> 方法在多线程下被同步加锁。</li> <li>假如没有静态的内容，那么不会生成 <code>&lt;clinit&gt;()</code> 这个方法。</li> <li>虚拟机在加载类的时候仅会执行一次 <code>&lt;clinit&gt;()</code>，也就是说类的加载仅有一次，所以 Class 模板只有一个。</li></ul> <p>除了 <code>&lt;clinit&gt;()</code> 之外，上图还有一个 <code>&lt;init&gt;</code>，这其实对应着我们类的实例的构造器，用于对非静态变量进行解析初始化。</p> <hr> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>maple<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/2021-09-25-10-24-24.01eddeed.png" alt=""></p> <p>类加载子系统的三个阶段：加载、链接、初始化。</p> <p>在这个 Demo 中，链接中的准备阶段赋值默认值 null，随后在初始化阶段赋值 <code>new Person()</code>。</p> <hr> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个 Demo 中也类似，首先在链接的准备阶段赋值默认值 0，随后在初始化阶段的静态代码块中赋值为 20，然后在静态变量赋值上赋值 10。</p> <p><img src="/assets/img/2021-09-25-10-34-34.f8bd2de3.png" alt=""></p> <hr> <h2 id="类加载器"><a href="#类加载器" class="header-anchor">#</a> 类加载器</h2> <p><strong>类加载器分类</strong></p> <p>JVM 支持两种类加载器：</p> <ul><li><p>Bootstrap ClassLoader：引导类加载器。</p></li> <li><p>User Defined ClassLoader：自定义类加载器，它又分为：</p> <ul><li>Extension ClassLoader：扩展类加载器。</li> <li>System ClassLoader（也叫做 Application ClassLoader）：系统类加载器。</li> <li>自定义的类加载器。</li></ul></li></ul> <p><img src="/assets/img/2021-09-25-10-43-21.b9b12d05.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">Tips</p> <p>各个类加载器都没有父子继承关系，可以理解为包含关系。
Bootstrap ClassLoader 包含 Extension ClassLoader，Extension ClassLoader 包含 System ClassLoader ……
除了 BootStrap ClassLoader 之外，所有类加载器继承 ClassLoader 这个抽象类。</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassLoader</span> systemClassLoader <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassLoader</span> extensionClassLoader <span class="token operator">=</span> systemClassLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取不到属于正常，因为 Bootstrap ClassLoader 用 C++ 写的，属于 JVM 的一部分，并不是 Java 类</span>
        <span class="token class-name">ClassLoader</span> bootstrapClassLoader <span class="token operator">=</span> extensionClassLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>systemClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>extensionClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bootstrapClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>虚拟机自带的类加载器</strong></p> <ul><li><p>BootStrap ClassLoader：引导类加载器：</p> <p>使用 C/C++ 编写，没有父加载器。</p> <p>嵌套在 JVM 内部，用来加载 Java 核心类库（<code>$JAVA_HOME/jre/lib/rt.jar</code>、<code>resources.jar</code>、<code>sum.boot.class.path</code> 等路径下的内容），用于提供 JVM 自身所需要的类。</p> <p>可以加载扩展类和系统类加载器，并且指定它们的父类加载器。</p> <p>可以使用 <code>URL[] urls = Launcher.getBootstrapClassPath().getURLs();</code> 来获取所有能够加载的路径。</p> <p>出于安全考虑，BootStrapClassLoader 只加载包名为 <code>java、javax、sun</code> 等开头的类。</p></li> <li><p>Extension ClassLoader：扩展类加载器：</p> <p>Java 语言编写。派生自 ClassLoader 类。父类加载器为 BootStrap ClassLoader。</p> <p>从 <code>java.ext.dirs</code> 系统属性所指定的目录中加载类库，或从 JDK 的安装目录的 <code>jre/lib/ext</code> 子目录（扩展目录）下加载类库。如果用户创建的 jar 放在此目录下，也会自动由扩展类加载器加载。</p> <p>使用 <code>Arrays.stream(System.getProperty(&quot;java.ext.dirs&quot;).split(&quot;;&quot;)).forEach(System.out::println);</code> 获取所有扩展类加载器可以加载的位置。</p></li></ul> <p><strong>用户自定义的类加载器</strong></p> <ol><li><p>什么情况下需要使用到自定义类加载器：</p> <ul><li>隔离加载类：例如说，某些情况下我们需要使用到中间件，而中间件之间的类（如类名）相互冲突，这个时候需要人工仲裁，自然需要将类隔离。</li> <li>修改类加载的方式：除了 BootStrap 之外，其他的类完全可以懒加载，而不是在一开始的时候完全加载进去。</li> <li>扩展类加载源：类的加载完全可以通过网络、jar、磁盘等等加载，可以自定义类加载器，实现源的扩展。</li> <li>防止源码泄露：如果 Java 代码缺少反编译，那么字节码很容易被篡改，为了防止被篡改，可以实现一个类加载器去实现加密解密操作。</li></ul></li> <li><p>自定义类加载器的主要步骤：</p> <ol><li>继承 <code>java.lang.ClassLoader</code>。</li> <li>在 JDK1.2 之前需要重写 <code>loadClass()</code>，不过之后不建议重写 <code>loadClass()</code>，而是建议将自定义的类加载逻辑放到 <code>findClass()</code> 中。</li> <li>如果没有太过复杂的要求，可以直接继承 <code>URLClassLoader</code>，这样可以避免自己去编写 <code>findClass()</code> 方法和其获取字节码流的方式。</li></ol></li></ol> <h2 id="双亲委派机制和沙箱安全机制"><a href="#双亲委派机制和沙箱安全机制" class="header-anchor">#</a> 双亲委派机制和沙箱安全机制</h2> <p><strong>双亲委派机制概述</strong></p> <p>Java 虚拟机对 class 文件采用的方式为按需加载的方式，加载某个类的 class 文件时，Java 虚拟机采用双亲委派机制，它是一种任务委派模式。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>当前代码的结构如上图所示，注意，这里的 <code>java.lang.String</code> 为自己创建的。</p> <p>我们创建了一个 <code>java.lang.String</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">lang</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义的静态代码块&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在链接阶段中的初始化阶段中，静态代码块中的内容会执行，但是我们手动 <code>new String</code> 的时候，并不会有这个语句产生。所以从结果上来看，我们初始化的 String 应该是 JDK 的而不是我们定义的。</p> <p>其实以上就是双亲委派机制的一个例子，它其实十分简单：</p> <ol><li>假如一个类加载器接收到了类加载的请求，他不会首先去加载，而是将这个类加载器委托给它的父类的加载器，让那个加载器去加载。</li> <li>继续第一步，直到到达顶层的启动类加载器。</li> <li>BootStrap ClassLoader 会加载 java、javax 等包下的内容，而 Extension ClassLoader 会加载指定目录下的包。按照刚才的委托来看，BootStrap ClassLoader 可以直接加载 JDK 的 String，那么就不会加载自定义的 String。</li></ol> <p>双亲委派的优势：</p> <ol><li>避免类的重复加载。</li> <li>保证程序的安全性，避免核心 API 被篡改。</li></ol> <p><strong>沙箱安全机制</strong></p> <p>在前面的双亲委派机制过程中，假如我们这样定义：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>lang</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义的静态代码块&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello JVM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>假如我们直接在 String 下面定义一个 main 方法，然后执行这个 main 方法，表面上看起来它不得不加载，然而事实上它会直接报错。这种安全防御机制就叫做沙箱安全机制。</p> <h2 id="类的主动使用和被动使用"><a href="#类的主动使用和被动使用" class="header-anchor">#</a> 类的主动使用和被动使用</h2> <p>在 JVM 中，判断两个对象完全一致需要符合两个条件：</p> <ul><li>类的完整名称（包名 + 类名）必须完全一致。</li> <li>加载这个类的类加载器相同，也就是指 ClassLoader 实例对象完全相同。</li></ul> <blockquote><p>ClassLoader 实例对象</p></blockquote> <p>这个实例对象比较类似类和对象之间的关系，类加载器本身只是一个模板，而真正起作用的是类加载器的实例。引导类加载器是 C++ 编写的，不能获取它的实例地址，但是其他的类加载器可以。只需要判断一下地址值是否相等就可以看出实例对象是否相等。</p> <hr> <p>对类加载器的引用：</p> <p>JVM 必须知道一个类型是由启动类加载器加载还是由用户类加载器加载的。假如是由用户类加载器加载的，那么 JVM 会将这个类加载器的一个引用作为类型信息的一部分放到方法区中。</p> <p>也就是说，当前我们的方法区中不仅保存了字节码文件，还保存了当前类加载器的实例。</p> <hr> <p>类的主动使用和被动使用：</p> <p>Java 会将一个类分为主动使用和被动使用，区别就是：主动使用会导致类的初始化，被动使用不会。</p> <blockquote><p>主动使用会导致类的初始化</p></blockquote> <p>这里的初始化指的不是类的构造方法，而是指类的初始化阶段（加载、链接、初始化中的初始化阶段），再简单来讲就是是不是调用了 <code>&lt;clinit&gt;()</code>。</p> <p>主动使用分为七种：</p> <ul><li>创建类的实例。</li> <li>访问某个类或者接口的静态变量，或者对静态变量进行赋值。</li> <li>调用类的静态方法。</li> <li>反射。</li> <li>初始化一个类的子类。</li> <li>Java 虚拟机启动时被标记为启动的类。</li> <li>JDK7 开始提供的动态语言支持。</li> <li><code>java.lang.invoke.MethodHandle</code> 实例的解析结果 <code>REF_getStatic、REF_putStatic、REF_invokeStatic</code> 句柄对应的类没有初始化则进行初始化。</li></ul> <p>除了以上七种情况之外，其余都是类的被动使用。</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://gitlab.com/team401/knowledge/-/edit/main/backend/JVM/part2.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">April 29, 2022 16:43</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: maple.wang@maiscrm.com" class="contributor">
          Maple Wang
        </span> , <span title="email: 2592716753@qq.com" class="contributor">
          causes
        </span> , <span title="email: 2592716753@qq.com" class="contributor">
          红枫
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href="https://beian.miit.gov.cn/#/Integrated/index">鲁ICP备20021989号-2</a></div> <!----></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.00946664.js" defer></script><script src="/assets/js/vendors~layout-Layout.d74da02a.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.70129eef.js" defer></script><script src="/assets/js/page-JVM-02-类加载子系统.4442a927.js" defer></script>
  </body>
</html>
